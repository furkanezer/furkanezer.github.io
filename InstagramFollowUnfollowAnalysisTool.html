<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Follow/Unfollow Analiz Aracı</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState } = React;

        
        const Shield = () => (
            <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
        );

        const AlertCircle = () => (
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );
        
        
        const CheckCircle = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );


        const Upload = () => (
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="17 8 12 3 7 8"></polyline>
                <line x1="12" y1="3" x2="12" y2="15"></line>
            </svg>
        );

        const Download = () => (
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
        );

        const UserMinus = () => (
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2">
                <path d="M16 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                <circle cx="8.5" cy="7" r="4"></circle>
                <line x1="23" y1="11" x2="17" y2="11"></line>
            </svg>
        );

        function App() {
            const [mode, setMode] = useState('info');
            const [followingData, setFollowingData] = useState([]);
            const [followersData, setFollowersData] = useState([]);
            const [nonFollowers, setNonFollowers] = useState([]);
            const [stats, setStats] = useState({
                totalFollowing: 0,
                totalFollowers: 0,
                nonFollowersCount: 0
            });
            const [errorMessage, setErrorMessage] = useState(null);

            
            const parseInstagramData = (text, type) => {
                setErrorMessage(null); 
                try {
                    const data = JSON.parse(text);
                    let list = [];

                    
                    if (Array.isArray(data)) {
                        list = data;
                    } 
                    
                    else if (typeof data === 'object' && data !== null) {
                        
                        for (const value of Object.values(data)) {
                            if (Array.isArray(value) && value.length > 0 && typeof value[0] === 'object' && (value[0].title || value[0].string_list_data)) {
                                list = value;
                                break; 
                            }
                        }
                    }

                    if (list.length === 0) {
                        throw new Error('LIST_NOT_FOUND'); 
                    }

                    
                    return list.map(item => {
                        let username = null;
                        let timestamp = null;

                        if (type === 'following') {
                           
                            username = item.title;
                            
                            timestamp = item.string_list_data?.[0]?.timestamp;

                        } else if (type === 'followers') {
                           
                            const dataItem = item.string_list_data?.[0];
                            username = dataItem?.value;
                            timestamp = dataItem?.timestamp;
                        }

                        
                        if (username) {
                            
                            if (!username && item.string_list_data?.[0]?.value) {
                                username = item.string_list_data[0].value;
                            }

                            return { username, timestamp };
                        }
                        return null; 
                    }).filter(user => user !== null); 

                } catch (e) {
                    console.error("JSON Ayrıştırma veya Yapı Hatası:", e);
                    
                    if (e.message === 'LIST_NOT_FOUND') {
                        setErrorMessage('Yüklediğiniz dosyanın içinde beklenen Instagram kullanıcı listesi yapısı bulunamadı. Lütfen doğru JSON dosyası olduğundan emin olun.');
                    } else {
                        setErrorMessage('JSON Ayrıştırma Hatası. Dosya bozuk veya geçersiz bir formatta.');
                    }
                    return [];
                }
            };

            const handleFileUpload = (e, type) => {
                const files = Array.from(e.target.files);
                if (files.length === 0) return;
                
                let processedCount = 0;
                let successfulData = [];

               
                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const data = parseInstagramData(event.target.result, type); 
                        if (data.length > 0) {
                            successfulData = [...successfulData, ...data];
                        }
                        
                        processedCount++;
                        
                       
                        if (processedCount === files.length) {
                            if (type === 'following') {
                                setFollowingData(prevData => [...prevData, ...successfulData]);
                            } else {
                                setFollowersData(prevData => [...prevData, ...successfulData]);
                            }
                        }
                    };
                    reader.readAsText(file);
                });


                e.target.value = null; 
            };
            
            
            const clearData = (type) => {
                if (type === 'following') {
                    setFollowingData([]);
                } else {
                    setFollowersData([]);
                }
                setNonFollowers([]); 
                setStats({ totalFollowing: 0, totalFollowers: 0, nonFollowersCount: 0 });
                setErrorMessage(null);
            };

            
            const analyzeData = () => {
                if (followingData.length === 0 || followersData.length === 0) {
                    setErrorMessage('Lütfen hem Takip Edilen hem de Takipçi listelerini yükleyin.');
                    return;
                }
                
                setErrorMessage(null);

                
                const followersSet = new Set(followersData.map(f => f.username.toLowerCase()));
                
                
                const notFollowingBack = followingData.filter(
                    user => user.username && !followersSet.has(user.username.toLowerCase())
                );
                
               
                const finalNonFollowers = notFollowingBack.map(user => ({
                    username: user.username,
                   
                }));

                setNonFollowers(finalNonFollowers);
                setStats({
                    totalFollowing: followingData.length,
                    totalFollowers: followersData.length,
                    nonFollowersCount: finalNonFollowers.length
                });
                setMode('analyze');
            };

            
            const exportToCSV = () => {
                const csv = 'Username,Profile URL\n' + 
                    nonFollowers.map(u => `${u.username},https://instagram.com/${u.username}`).join('\n');
                
                const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
                const url = window.URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'instagram_geri_takip_etmeyenler.csv';
                a.click();
            };

            
            const InfoScreen = () => (
                <div className="max-w-4xl mx-auto p-6 bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
                    <div className="bg-white rounded-2xl shadow-xl p-8">
                        <div className="flex items-center gap-3 mb-6">
                            <div className="text-purple-600"><Shield /></div>
                            <h1 className="text-3xl font-bold text-gray-800">Instagram Follow/Unfollow Analiz Aracı</h1>
                        </div>

                        <div className="bg-yellow-50 border-l-4 border-yellow-400 p-4 mb-6 rounded-lg">
                            <div className="flex items-start gap-3">
                                <div className="text-yellow-600 mt-1"><AlertCircle /></div>
                                <div>
                                    <h3 className="font-bold text-yellow-800 mb-2">ÖNEMLİ UYARI</h3>
                                    <p className="text-yellow-700 text-sm">
                                        Bu araç %100 güvenlidir. Instagram API kullanmaz, sadece indirdiğiniz veriyi analiz eder..
                                    </p>
                                </div>
                            </div>
                        </div>
                    
                        <div className="space-y-6">
                            {/* EKLENEN DIV BAŞLANGICI */}
                            <div className="bg-green-50 border border-green-200 rounded-lg p-6">
                                <h3 className="font-bold text-green-800 mb-4 flex items-center gap-2">
                                    <CheckCircle />
                                    Bu Araç Neler Yapar?
                                </h3>
                                <ul className="space-y-2 text-green-700 text-sm">
                                    <li>✓ Instagram verilerinizi analiz eder</li>
                                    <li>✓ Sizi takip etmeyenleri listeler</li>
                                    <li>✓ CSV formatında dışa aktarır</li>
                                    <li>✓ %100 güvenli ve yerel çalışır</li>
                                </ul>
                            </div>
                            {/* EKLENEN DIV SONU */}

                            <div className="bg-blue-50 border border-blue-200 rounded-lg p-6">
                                <h3 className="font-bold text-blue-800 mb-4">Nasıl Çalışır?</h3>
                                <ol className="space-y-3 text-blue-700 text-sm list-decimal list-inside">
                                    <li> Instagram → Ayarlar → Hesaplar Merkezi → Bilgilerin ve izinlerin → Bilgilerini dışa aktar. </li>
                                    <li> Dışarı aktarım oluştur → Cihaza aktar (işlemi yaparken Pc kullanmanızı tavsiye ediyoruz)</li>
                                    <li> Bilgileri özelleştir (sadece bağlantılar kısmı tikli olacak) → Tarih aralığı ( Her zaman )→ Format (JSON).</li>
                                    <li> Zip dosyasından çıkan `followers_and_following/` klasöründeki followers_1.json ve following.json dosyalarını yükleyin</li>
                                    <li> Analiz Et butonuna tıklayın</li>
                                    <li> Manuel olarak takipten çıkın</li>
                                </ol>
                            </div>

                            <button
                                onClick={() => setMode('manual')}
                                className="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white py-4 rounded-xl font-bold text-lg hover:from-purple-700 hover:to-pink-700 transition-all shadow-lg shadow-purple-300/50"
                            >
                                Verileri Yükle →
                            </button>
                        </div>
                    </div>
                </div>
            );

            const UploadScreen = () => (
                <div className="max-w-4xl mx-auto p-6 bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
                    <div className="bg-white rounded-2xl shadow-xl p-8">
                        <button onClick={() => setMode('info')} className="text-purple-600 mb-4 hover:underline font-medium">
                            ← Bilgilendirme Ekranına Dön
                        </button>

                        <h1 className="text-3xl font-bold text-gray-800 mb-6">Veri Yükleme</h1>

                        {errorMessage && (
                            <div className="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-lg flex items-center gap-3">
                                <AlertCircle />
                                <span>Hata: {errorMessage}</span>
                            </div>
                        )}

                        <div className="space-y-6">
                            {/* TAKİP EDİLENLER YÜKLEME ALANI */}
                            <div className="border-2 border-dashed border-purple-300 rounded-xl p-6 bg-purple-50 text-center">
                                <div className="text-purple-600 mx-auto mb-4 flex justify-center"><Upload /></div>
                                <h3 className="font-bold text-gray-800 mb-2">Takip Edilen Listesi (`following.json`)</h3>
                                <p className="text-sm text-gray-600 mb-4 font-bold text-purple-600">Kullanılan Etiket: `title`</p>
                                <input
                                    type="file"
                                    accept=".json"
                                    multiple 
                                    onChange={(e) => handleFileUpload(e, 'following')}
                                    className="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-purple-100 file:text-purple-700 hover:file:bg-purple-200"
                                />
                                {followingData.length > 0 && (
                                    <div className="flex justify-between items-center mt-3 p-2 bg-purple-100 rounded-lg">
                                        <p className="text-purple-700 font-semibold">
                                            ✓ {followingData.length} kullanıcı yüklendi 
                                        </p>
                                        <button 
                                            onClick={() => clearData('following')}
                                            className="text-xs text-red-500 hover:text-red-700 font-bold p-1 rounded transition-colors"
                                        >
                                            Temizle
                                        </button>
                                    </div>
                                )}
                            </div>

                            {/* TAKİPÇİLER YÜKLEME ALANI */}
                            <div className="border-2 border-dashed border-pink-300 rounded-xl p-6 bg-pink-50 text-center">
                                <div className="text-pink-600 mx-auto mb-4 flex justify-center"><Upload /></div>
                                <h3 className="font-bold text-gray-800 mb-2">Takipçi Listesi (`followers_1.json` vb.)</h3>
                                <p className="text-sm text-gray-600 mb-4 font-bold text-pink-600">Kullanılan Etiket: `Value`</p>
                                <input
                                    type="file"
                                    accept=".json"
                                    multiple
                                    onChange={(e) => handleFileUpload(e, 'followers')}
                                    className="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-pink-100 file:text-pink-700 hover:file:bg-pink-200"
                                />
                                {followersData.length > 0 && (
                                    <div className="flex justify-between items-center mt-3 p-2 bg-pink-100 rounded-lg">
                                        <p className="text-pink-700 font-semibold">
                                            ✓ {followersData.length} takipçi yüklendi 
                                        </p>
                                        <button 
                                            onClick={() => clearData('followers')}
                                            className="text-xs text-red-500 hover:text-red-700 font-bold p-1 rounded transition-colors"
                                        >
                                            Temizle
                                        </button>
                                    </div>
                                )}
                            </div>

                            {/* ANALİZ BUTONU */}
                            <button
                                onClick={analyzeData}
                                disabled={followingData.length === 0 || followersData.length === 0}
                                className={`w-full py-4 rounded-xl font-bold text-lg transition-all shadow-lg ${
                                    followingData.length > 0 && followersData.length > 0
                                        ? 'bg-gradient-to-r from-purple-600 to-pink-600 text-white hover:from-purple-700 hover:to-pink-700'
                                        : 'bg-gray-300 text-gray-500 cursor-not-allowed'
                                }`}
                            >
                                Analiz Et
                            </button>
                        </div>
                    </div>
                </div>
            );

            const AnalysisScreen = () => (
                <div className="max-w-6xl mx-auto p-6 bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen">
                    <div className="bg-white rounded-2xl shadow-xl p-8">
                        <button onClick={() => setMode('manual')} className="text-purple-600 mb-4 hover:underline font-medium">
                            ← Yeni Dosya Yükle
                        </button>

                        <h1 className="text-3xl font-bold text-gray-800 mb-6">Analiz Sonuçları</h1>

                        {/* İstatistik Kartları */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                            <div className="bg-blue-50 border-2 border-blue-200 rounded-xl p-6 text-center shadow-md">
                                <p className="text-blue-600 font-semibold mb-2">Toplam Takip Edilen</p>
                                <p className="text-4xl font-bold text-blue-800">{stats.totalFollowing}</p>
                            </div>
                            <div className="bg-green-50 border-2 border-green-200 rounded-xl p-6 text-center shadow-md">
                                <p className="text-green-600 font-semibold mb-2">Toplam Takipçi</p>
                                <p className="text-4xl font-bold text-green-800">{stats.totalFollowers}</p>
                            </div>
                            <div className="bg-red-50 border-2 border-red-200 rounded-xl p-6 text-center shadow-md">
                                <p className="text-red-600 font-semibold mb-2">Sizi Takip Etmeyen</p>
                                <p className="text-4xl font-bold text-red-800">{stats.nonFollowersCount}</p>
                            </div>
                        </div>

                        {/* CSV İndirme Butonu */}
                        {stats.nonFollowersCount > 0 && (
                            <button
                                onClick={exportToCSV}
                                className="flex items-center gap-2 bg-green-600 text-white px-6 py-3 rounded-lg font-semibold mb-6 hover:bg-green-700 transition-colors shadow-lg"
                            >
                                <Download />
                                CSV İndir ({stats.nonFollowersCount} Hesap)
                            </button>
                        )}

                        {/* Geri Takip Etmeyenler Listesi */}
                        <div className="bg-gray-50 rounded-xl p-6 shadow-inner max-h-[60vh] overflow-y-auto">
                            <h3 className="font-bold text-gray-800 mb-4 text-xl">Sizi Takip Etmeyenler Listesi:</h3>
                            <div className="space-y-3">
                                {nonFollowers.length > 0 ? (
                                    nonFollowers.map((user, index) => (
                                        <div key={index} className="flex items-center justify-between bg-white p-4 rounded-xl border border-gray-200 shadow-sm transition-shadow hover:shadow-md">
                                            <div className="flex items-center gap-3">
                                                <div className="w-10 h-10 bg-gradient-to-br from-purple-400 to-pink-400 rounded-full flex items-center justify-center text-white font-bold text-lg">
                                                    {/* Display first letter of username */}
                                                    {user.username.charAt(0).toUpperCase()} 
                                                </div>
                                                <a
                                                    
                                                    href={`https://instagram.com/${user.username}`}
                                                    target="_blank"
                                                    rel="noopener noreferrer"
                                                    className="font-semibold text-gray-800 hover:text-purple-600 transition-colors truncate max-w-[200px] sm:max-w-none"
                                                >
                                                    @{user.username}
                                                </a>
                                            </div>
                                            <a
                                                href={`https://instagram.com/${user.username}`}
                                                target="_blank"
                                                rel="noopener noreferrer"
                                                className="flex items-center gap-2 bg-red-100 text-red-600 px-4 py-2 rounded-full text-sm font-semibold hover:bg-red-200 transition-colors"
                                            >
                                                <UserMinus />
                                                Profil
                                            </a>
                                        </div>
                                    ))
                                ) : (
                                    <div className="text-center p-8 text-gray-500 text-lg bg-white rounded-lg border border-green-200">
                                        Tebrikler! Takip ettiğiniz herkes sizi geri takip ediyor.
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );

            
            if (mode === 'info') return <InfoScreen />;
            if (mode === 'manual') return <UploadScreen />;
            if (mode === 'analyze') return <AnalysisScreen />;
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>